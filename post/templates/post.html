{% load static %} 
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Python World | Posts</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&displsay=swap"
            rel="stylesheet" />
            <link rel="icon" href="{% static 'image/favicon.ico' %}" type="image/x-icon">
        <link rel="stylesheet" href="{% static 'css/scroll.css' %}" />
        <link rel="stylesheet" href="{% static 'css/post.css' %}" />
        <link rel="stylesheet" href="{% static 'css/uni.css' %}" />
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <style>
            .post-main-content {
                display: flex;
                flex-direction: row;
                gap: 20px;
            }
            
            .post-content-left {
                flex: 1;
                min-width: 0;
            }
            
            .post-content-right {
                width: 300px;
                flex-shrink: 0;
            }
            
            .comments-section {
                height: 90%;
                display: flex;
                flex-direction: column;
                border-left: 1px solid #e0e0e0;
                padding-left: 15px;
            }
            
            .comments-wrapper {
                flex: 1;
                overflow-y: auto;
                margin-bottom: 10px;
            }
            
            .comment-form {
                margin-top: auto;
                flex-shrink: 0;
            }

            .my-swal-popup {
                background-color:var(--dark-bg); /* Dark background */
                color: #ffffff; /* White text */
                border-radius: 10px;
              }
              
              .my-swal-title {
                color: var(--primary); /* Optional: gold title text */
              }
              
              .my-swal-html {
                color: var(--primary); /* Light gray content text */
              }
              
              .my-swal-button {
                background-color: #28a745 !important; /* Green button */
                color: white !important;
              }

              .tag-radio-group {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
              }
              
              .tag-radio-group label {
                background-color: #1e293b;
                color: #e2e8f0;
                padding: 8px 16px;
                border-radius: 25px;
                font-size: 0.9rem;
                cursor: pointer;
                transition: background-color 0.3s, transform 0.2s;
                border: 2px solid transparent;
              }
              
              .tag-radio-group input[type="radio"]:checked + label {
                background-color: var(--accent); /* Use your accent color */
                color: white;
                transform: scale(1.05);
                border-color: white;
              }
              
              .tag-radio-group label:hover {
                background-color: #334155;
              }
              
              
        </style>
        <style>
            .gradient-strip {
                height: 7px;
                width: 100%;
                background: linear-gradient(to right, #ff5733, #ffc300, #28b463);
                position: absolute;
                bottom: 0;
                left: 0;
                transition: 1s;
                background-size: 600% 600%;
                animation: gradientShift 1s linear infinite;
            }       
            @keyframes gradientShift {
                0% {
                    background-position: 0% 50%;
                }
                50% {
                    background-position: 100% 50%;
                }
                100% {
                    background-position: 0% 50%;
                }
            }
            
            #gradient-strip {
                opacity: 0;
                height: 0;
                overflow: hidden;
                transition: opacity 0.5s ease, 0.5 out;
            }
            #gradient-strip.show {
                opacity: 1;
                height: 7px;
                bottom:-5px;
            }
            
        </style>
    </head>
    <body style="width: 100%">
        
        <header style="width: 100%; padding-left: 11.2rem; padding-right: 11.2rem">
            <form action="{% url 'ai' 'post.html' %}" id="voiceForm" method="POST" style="display:none;">
                {% csrf_token %}
                <input type="hidden" id="questionInput" name="question">
            </form>
            <div class="container header-container">
                <button type="button" onclick="startDictation()" id="start" style="display: none;"></button>
                <div class="logo" onclick="window.location.href = '{% url 'index' %}'">Python<span>World</span></div>
                <div class="search-bar">
                    <input type="text" placeholder="Search for Posts ... " id="searchInput" />
                    <div
                        id="searchResults"
                        style="
                            position: absolute;
                            top: 100%;
                            left: 0;
                            width: 100%;
                            z-index: 10;
                            background-color: var(--card-bg);
                            padding: 1rem;
                            border-radius: 12px;
                            display: none;
                        "></div>
                </div>
                <div class="nav-links">
                    <a href="{% url 'feed' %}"><pre><i class="fas fa-rss"></i>  Feed</pre></a>
                    <a href="{% url 'article' %}"><pre><i class="fas fa-file-alt"></i>  Articles</pre></a>
                    <a href="{% url 'qna' %}"><pre><i class="fas fa-question-circle"></i>  Q&A</pre></a>
                    <a href="{% url 'utils' %}"><pre><i class="fas fa-tools"></i>  Utilities</pre></a>
                    {% if not request.session.user_id %}
                    <button class="primary-btn" onclick="window.location.href='{% url 'login' %}'">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                    {% else %}
                    <a href="{% url 'profile' request.session.username %}" style="color: var(--primary); font-weight: 600">
                        {{request.session.username}}
                    </a>
                    <button class="primary-btn" onclick="window.location.href='{% url 'logoutUser' %}'">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                    {% endif %}
                </div>
            </div>
            <div class="gradient-strip" id="gradient-strip"></div>
        </header>
        
        <div style="width: 100%; display: flex; flex-direction: row;">

            <!-- Left Section -->
            <div
                style="
                    width: 20%;
                    display: flex;
                    height: 100%;
                    justify-content: center;
                    align-items: center;
                    flex-direction: column; 
                ">
                <div class="profile-avatar" style="margin-top: 10rem">
                    {% if user.profilePicUrl %}
                    <img src="{{user.profilePicUrl}}" alt="{{user.username}}'s profile" />

                    {% endif %}
                </div>
                {{request.session.username}}
                <br />
                <br />
                <button id="openPostModalButton" class="add-post-btn" onclick="document.getElementById('postModal').style.display = 'block';">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Add Post
                </button>
            </div>

            <!-- Feed of Posts -->
            <div class="posts-container" id="posts-container" style="overflow-x:visible">
                <form method="POST" action="{% url 'postFilter' %}">
                {% csrf_token %}
                <div class="category-filters">
                    <button class="category-filter {% if selected_filter == 'all' %}active{% endif %}" type="submit" name="filterBtn" value="all">All</button>
                    <button class="category-filter {% if selected_filter == 'new' %}active{% endif %}" type="submit" name="filterBtn" value="new">New to You</button>
                    <button class="category-filter {% if selected_filter == 'mostLiked' %}active{% endif %}" type="submit" name="filterBtn" value="mostLiked">Most Liked</button>
                    <button class="category-filter {% if selected_filter == 'mostShared' %}active{% endif %}" type="submit" name="filterBtn" value="mostShared">Most Commented</button>
                </form>
                </div>

                {% for post in posts %}
                <div class="post-card fade-in" id="post-{{ post.id }}">
                    <div class="post-header">
                        <div class="post-author">
                            <div class="avatar">{{ post.posted_by.username|first|upper }}</div>
                            <div>
                                <div class="author-name"><a href="{% url 'profile' post.posted_by.username %}" style="text-decoration:none; color:var(--primary)">{{ post.posted_by.username }}</a></div>
                                <div class="post-date">{{ post.created_at|date:"M d, Y" }}</div>
                            </div>
                        </div>
                        <div class="post-tags">
                            {% for tag in post.tags %}
                            {% if tag == "discussion" %}
                            <span class="tag" style="background-color:#14b8a6;color:black;">Discussion</span>
                            {% endif %}
                            {% if tag == "tutorial" %}
                            <span class="tag" style="background-color:yellow;color:black;">Tutorial</span>
                            {% endif %}
                            {% if tag == "project" %}
                            <span class="tag" style="background-color:#6366f1 ;color:#ffffff;">Project</span>
                            {% endif %}
                            {% if tag == "news" %}
                            <span class="tag" style="background-color:#facc15 ;color:black;">News</span>
                            {% endif %}
                            {% if tag == "idea" %}
                            <span class="tag" style="background-color:#10b981 ;color:#ffffff;">Idea</span>
                            {% endif %}
                            {% if tag == "question" %}
                            <span class="tag" style="background-color:#f97316 ;color:#ffffff;">Question</span>
                            {% endif %}
                            {% if tag == "guide" %}
                            <span class="tag" style="background-color:#0ea5e9 ;color:black;">Guide</span>
                            {% endif %}
                            {% if tag == "opinion" %}
                            <span class="tag" style="background-color:#a78bfa ;color:black;">Opinion</span>
                            {% endif %}
                            {% if tag == "career" %}
                            <span class="tag" style="background-color:#ef4444 ;color:#ffffff;">Career</span>
                            {% endif %}
                            {% if tag == "other" %}
                            <span class="tag" style="background-color:blue;color:#ffffff;">Other</span>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <div class="post-main-content">
                        <div class="post-content-left">
                            <h2 class="post-title">{{ post.title }}</h2>
                            <div class="post-content" style="max-height: 250px; overflow-y: auto">{{ post.content|linebreaks }}</div>

                            {% if post.image_url != "" %}
                            <div class="post-image-container">
                                <div class="post-image">
                                    <img
                                        src="{{post.image_url}}"
                                        alt="{{post.title}}"
                                        class="post-image"
                                        onclick="openImageModal('{{ post.image_url }}')"  loading="lazy"/>
                                </div>
                            </div>
                            {% endif %}

                            <div class="post-actions">
                                <div class="likes">
                                    <button onclick="toggleLike('{{ post.id }}')" id="like-btn-{{ post.id }}">
                                        <span id="like-icon-{{ post.id }}">
                                            {% if user in post.likes %}
                                                <i class="fas fa-heart" style="color: red;font-size:1rem"></i>
                                            {% else %}
                                                <i class="fas fa-heart" style="font-size:1rem"></i>
                                            {% endif %}
                                        </span>
                                        <span id="like-count-{{ post.id }}">{{ post.likes|length }}</span>
                                    </button>
                                    <button onclick="copyLinkToPost('{{ post.id }}')" style="margin-left:2rem"> <pre><i class="fa-solid fa-share"></i>  Share </pre></button>
                                </div>

                                <div class="comments-count">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="20"
                                        height="20"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                    </svg>
                                    <span>{{ post.comments|length }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="post-content-right">
                            <div class="comments-section" id="comment-section-{{ post.id }}">
                                <h3>
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="18"
                                        height="18"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                    </svg>
                                    Comments
                                </h3>

                                <div class="comments-wrapper" id="comments-wrapper-{{ post.id }}">
                                    {% for comment in post.comments %}
                                    <div class="comment">
                                        <div class="comment-header">
                                            <div class="comment-author">
                                                <div class="avatar">{{ comment.created_by.username|first|upper }}</div>
                                                <div class="author-name">{{ comment.created_by.username }}</div>
                                            </div>
                                            <div class="comment-date">{{ comment.created_at|date:"M d, Y" }}</div>
                                        </div>
                                        <div class="comment-content">{{ comment.comment_body }}</div>
                                    </div>
                                    {% empty %}
                                    <div class="no-comments">No comments yet. Be the first to comment!</div>
                                    {% endfor %}
                                </div>

                                <!-- Comment form -->
                                <div class="form-group comment-form">
                                    <textarea
                                        id="comment-input-{{ post.id }}"
                                        placeholder="Write a comment..."
                                        required></textarea>
                                        <button
                                        onclick="submitComment('{{ post.id }}')"
                                        type="submit"
                                        style="width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; margin-top: auto; margin-bottom: auto; padding: 0;">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            style="width: 60%; height: 60%;">
                                            <line x1="22" y1="2" x2="11" y2="13"></line>
                                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                        </svg>
                                    </button>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <path d="M21 15l-5-5L5 21"></path>
                    </svg>
                    <h3>No posts yet</h3>
                    <p>Be the first to share with the Python community!</p>
                    <button
                        class="add-post-btn"
                        id="empty-add-post-btn"
                        style="
                            margin-top: 1.5rem;
                            margin-left: auto;
                            margin-right: auto;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">
                        <div>Create Post</div>
                    </button>
                </div>
                {% endfor %}

                <!-- Loading indicator for infinite scroll -->
                <div class="loading" id="loading-indicator" style="display: none">
                    <div class="loading-spinner"></div>
                    <p>Loading more posts...</p>
                </div>
            </div>

            <!-- Modal for image enlargement -->
            <div id="imageModal" class="image-modal" onclick="closeImageModal()">
                <span id="cancelBtn" class="cancel-btn" onclick="closeImageModal()"></span>
                <img id="modalImage" class="modal-image" src="" alt="Enlarged Image" />
            </div>

           
        </div>

         <!-- Post creation modal -->
         <div id="postModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="document.getElementById('postModal').style.display = 'none';">&times;</span>
                <div class="modal-header">
                    <h2><i class="fas fa-edit"></i> Create New Post</h2>
                </div>
                <form class="post-form" action="{% url 'post' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="text" name="title" placeholder="Post Title" required>
                    <textarea name="content" placeholder="What's on your mind?" required></textarea>
                    <div class="tag-radio-group">
                        <input type="radio" name="post_type" id="tutorial" value="tutorial" hidden>
                        <label for="tutorial">Tutorial</label>
                      
                        <input type="radio" name="post_type" id="project" value="project" hidden>
                        <label for="project">Project</label>
                      
                        <input type="radio" name="post_type" id="discussion" value="discussion" hidden>
                        <label for="discussion">Discussion</label>
                      
                        <input type="radio" name="post_type" id="news" value="news" hidden>
                        <label for="news">News</label>
                      
                        <input type="radio" name="post_type" id="idea" value="idea" hidden>
                        <label for="idea">Idea</label>
                      
                        <input type="radio" name="post_type" id="question" value="question" hidden>
                        <label for="question">Question</label>
                      
                        <input type="radio" name="post_type" id="guide" value="guide" hidden>
                        <label for="guide">Guide</label>
                      
                        <input type="radio" name="post_type" id="opinion" value="opinion" hidden>
                        <label for="opinion">Opinion</label>
                      
                        <input type="radio" name="post_type" id="career" value="career" hidden>
                        <label for="career">Career</label>

                        <input type="radio" name="post_type" id="career" value="career" hidden>
                        <label for="career">Other</label>
                      </div>
                      <br>
                    <div class="file-upload">
                        <label for="post-image">
                            <i class="fas fa-image"></i> Add an image to your post (optional)
                        </label>
                        <input type="file" id="post-image" name="imageUrl" enctype="multipart/form-data">
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="secondary-btn close-modal" onclick="document.getElementById('postModal').style.display = 'none';">Cancel</button>
                        <button type="submit" class="primary-btn">
                            <i class="fas fa-paper-plane"></i> Publish
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>

            function openImageModal(imageUrl) {
                document.getElementById("imageModal").style.display = "flex";
                document.getElementById("modalImage").src = imageUrl;
            }

            function closeImageModal() {
                document.getElementById("imageModal").style.display = "none";
            }

            // CSRF token for AJAX requests
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== "") {
                    const cookies = document.cookie.split(";");
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === name + "=") {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            // Like functionality
            function toggleLike(postId) {
                fetch(`/post/${postId}/like/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken"),
                        "Content-Type": "application/json",
                    },
                })
                    .then((response) => response.json())
                    .then((data) => {
                        const icon = document.getElementById(`like-icon-${postId}`);
                        const count = document.getElementById(`like-count-${postId}`);

                        // Replace icon SVG
                        icon.innerHTML = data.liked
                            ? `<i class="fas fa-heart" style="color: red;font-size:1rem"></i>`
                            : `<i class="fas fa-heart" style="font-size:1rem"></i>`;

                        // Update count
                        count.textContent = data.like_count;
                    });
            }

            function submitComment(postId) {
                const input = document.getElementById(`comment-input-${postId}`);
                const content = input.value.trim();
                if (!content) {
                    alert("Please enter a comment.");
                    return;
                }

                fetch(`/post/${postId}/comment/`, {
                    method: "POST",
                    headers: {
                        "X-CSRFToken": getCookie("csrftoken"),
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: `content=${encodeURIComponent(content)}`,
                })
                    .then((response) => {
                        if (!response.ok) throw new Error("Failed to post comment.");
                        return response.json();
                    })
                    .then((data) => {
                        const commentSection = document.getElementById(`comments-wrapper-${postId}`);
                        const newComment = document.createElement("div");
                        newComment.classList.add("comment");
                        newComment.innerHTML = `
                            <div class="comment-header">
                                <div class="comment-author">
                                    <div class="avatar">${data.initial}</div>
                                    <div class="author-name">${data.username}</div>
                                </div>
                                <div class="comment-date">${data.created_at}</div>
                            </div>
                            <div class="comment-content">${data.comment_body}</div>
                        `;
                        commentSection.appendChild(newComment);
                        input.value = "";
                    })
                    .catch((err) => alert(err.message));
            }

            // Check if we need to add scroll to comment sections - updated for new layout
            document.addEventListener("DOMContentLoaded", function () {
                const commentWrappers = document.querySelectorAll(".comments-wrapper");

                commentWrappers.forEach((wrapper) => {
                    // Comments wrapper now always has scroll in the right sidebar
                    wrapper.style.overflowY = "auto";
                });
            });

            // Infinite scrolling simulation
            // const postsContainer = document.getElementById("posts-container");
            // const loadingIndicator = document.getElementById("loading-indicator");
            // let isLoading = false;
            // let page = 1;

            // function loadMorePosts() {
            //     if (isLoading) return;

            //     // Show loading indicator
            //     isLoading = true;
            //     loadingIndicator.style.display = "block";

            //     // Simulate API call with timeout
            //     setTimeout(() => {
            //         // This would be replaced with actual fetch call to get more posts
            //         // For demo purposes, we'll just clone existing posts
            //         const posts = document.querySelectorAll(".post-card:not(.loading)");

            //         if (posts.length > 0 && page < 3) {
            //             // Limit to prevent too many clones
            //             // Insert loading indicator before the first post
            //             loadingIndicator.style.display = "none";

            //             // Clone and append posts with new IDs
            //             posts.forEach((post) => {
            //                 const clone = post.cloneNode(true);
            //                 clone.classList.add("fade-in");

            //                 // Update IDs to make them unique
            //                 const postId = Math.random().toString(36).substring(2, 10);

            //                 // Update all IDs in the clone
            //                 const elements = clone.querySelectorAll("[id]");
            //                 elements.forEach((el) => {
            //                     const oldId = el.id;
            //                     const newId = oldId.replace(/\d+$/, postId);
            //                     el.id = newId;
            //                 });

            //                 // Append clone after loading indicator
            //                 postsContainer.insertBefore(clone, loadingIndicator);

            //                 // Ensure comment wrapper has scroll
            //                 const commentWrapper = clone.querySelector(".comments-wrapper");
            //                 if (commentWrapper) {
            //                     commentWrapper.style.overflowY = "auto";
            //                 }
            //             });

            //             page++;
            //         } else {
            //             // No more posts to load
            //             loadingIndicator.innerHTML = "<p>No more posts to load</p>";
            //             setTimeout(() => {
            //                 loadingIndicator.style.display = "none";
            //             }, 2000);
            //         }

            //         isLoading = false;
            //     }, 1000);
            // }

            // Detect when user scrolls to bottom of posts container
            postsContainer.addEventListener("scroll", function () {
                const { scrollTop, scrollHeight, clientHeight } = postsContainer;

                if (scrollTop + clientHeight >= scrollHeight - 100 && !isLoading) {
                    loadMorePosts();
                }
            });

            var modal = document.getElementById("postModal");
            var openModalBtn = document.getElementById("openPostModal");
            var openModalButtonHeader = document.getElementById("openPostModalButton");
            var emptyStateButton = document.getElementById("emptyStatePostButton");
            var closeBtn = document.getElementsByClassName("close")[0];
            var cancelBtn = document.getElementsByClassName("close-modal")[0];
            
            // Open modal when buttons are clicked
            if (openModalBtn) {
                openModalBtn.onclick = function() {
                    modal.style.display = "block";
                }
            }
            
            if (openModalButtonHeader) {
                openModalButtonHeader.onclick = function() {
                    modal.style.display = "block";
                }
            }
            
            if (emptyStateButton) {
                emptyStateButton.onclick = function() {
                    modal.style.display = "block";
                }
            }
            
            // Close modal when X is clicked
            if (closeBtn) {
                closeBtn.onclick = function() {
                    modal.style.display = "none";
                }
            }
            
            // Close modal when Cancel is clicked
            if (cancelBtn) {
                cancelBtn.onclick = function() {
                    modal.style.display = "none";
                }
            }
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
            
            // File upload preview
            const fileInput = document.getElementById('post-image');
            const fileLabel = document.querySelector('.file-upload label');
            
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        const fileName = this.files[0].name;
                        fileLabel.innerHTML = `<i class="fas fa-check"></i> ${fileName} selected`;
                        fileLabel.style.color = 'var(--success)';
                    } else {
                        fileLabel.innerHTML = `<i class="fas fa-image"></i> Add an image to your post (optional)`;
                        fileLabel.style.color = 'var(--text)';
                    }
                });
            }

            function copyLinkToPost(postId) {
                const baseUrl = window.location.origin + window.location.pathname;
                const fullUrl = `${baseUrl}#post-${postId}`;
            
                navigator.clipboard.writeText(fullUrl)
                  .then(() => {
                    Swal.fire({
                        title: "Link copied to clipboard!",
                        icon: "success",
                        html: `
                          <div style="margin-bottom: 10px;margin-top:5px;">
                            <a href="https://wa.me/?text=${encodeURIComponent(fullUrl)}" target="_blank" style="margin: 0 12px;text-decoration: none;">
                              <img src="https://cdn.simpleicons.org/whatsapp/FFFFFF" alt="WhatsApp" width="32" height="32">
                            </a>
                            <a href="https://www.instagram.com/" target="_blank" style="margin: 0 12px;text-decoration: none;">
                              <img src="https://cdn.simpleicons.org/instagram/FFFFFF" alt="Instagram" width="32" height="32">
                            </a>
                            <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(fullUrl)}" target="_blank" style="margin: 0 12px;">
                              <img src="https://cdn.simpleicons.org/x/FFFFFF" alt="X" width="32" height="32">
                            </a>
                          </div>
                          
                          <p style="margin-top: 20px;">Paste link anywhere to share</p>
                        `,
                        showCloseButton: true,
                        showCancelButton: false,
                        focusConfirm: false,
                        confirmButtonText: `
                          <i class="fa fa-thumbs-up"></i> Great!
                        `,
                        confirmButtonAriaLabel: "Thumbs up, great!",
                        customClass: {
                            popup: 'my-swal-popup',
                            title: 'my-swal-title',
                            htmlContainer: 'my-swal-html',
                            confirmButton: 'my-swal-button'
                          }
                      });
                  })
                  .catch(() => {
                    Swal.fire({
                      icon: 'error',
                      title: 'Failed to copy link \n Try Again',
                      showConfirmButton: false,
                      timer: 1500
                    });
                  });
              }

                window.addEventListener('load', () => {
                  const target = window.location.hash;
                  if (target) {
                    const el = document.querySelector(target);
                    if (el) {
                      el.scrollIntoView({ behavior: 'smooth' });
                    }
                  }
                });
              
                  
        </script>

        <script>

            let recognition;
            let isListening = false;
            const startBtn = document.getElementById("start");
            document.getElementById("gradient-strip").classList.remove("show");
            document.addEventListener("keydown", function(event) {
              if (event.key === "Shift") {
                  startDictation();
              }
          });
      
      
      
              setInterval(() => {
      
                if (startBtn) {
                    startBtn.disabled = isListening;
                }
            }, 200);
            
      
      
      
              function startDictation() {
                document.getElementById("gradient-strip").classList.add("show");
                   window.speechSynthesis.cancel();
      
                  if ('webkitSpeechRecognition' in window) {
                      recognition = new webkitSpeechRecognition();
                      recognition.continuous = false;
                      recognition.interimResults = false;
                      recognition.lang = "en-US";
                      recognition.start();
                      isListening = true;
                      recognition.onresult = function (event) {
                          const transcript = event.results[0][0].transcript;
                          console.log(transcript);
                          document.getElementById('questionInput').value = transcript;
                          recognition.stop();
                          isListening = false;
                          document.getElementById('voiceForm').submit();
                      };
      
                      recognition.onerror = function (event) {
                          //alert('Speech recognition error: ' + event.error);
                          recognition.stop();
                          isListening = false;
                      };
      
                      recognition.onend = function () {
                          isListening = false;
                          document.getElementById("gradient-strip").classList.remove("show");
                      };
                  } else {
                      alert("Your browser does not support speech recognition.");
                  }
              }
      
              function stopDictation() {
                  window.speechSynthesis.cancel();
                  if (recognition) {
                      recognition.stop();
                  }
              }
      
              {% if answer %}
                  // Only run this if there's an answer
                  const aiSpeech = new SpeechSynthesisUtterance("{{ answer|escapejs }}");
                  aiSpeech.onend = () => {
                      startDictation(); // Wait till AI finishes speaking, then listen again
    
                  };
      
                  window.speechSynthesis.cancel(); // Cancel anything playing
                  window.speechSynthesis.speak(aiSpeech);
                  isListening = false;
              {% endif %}
    
          </script>
          <script src="{% static "js/searchpost.js" %}"></script>
    </body>
    <div id="mobile-warning">
        This site is not made for mobile phones
    </div>
</html>